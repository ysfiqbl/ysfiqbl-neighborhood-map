$(document).ready(function(){function a(a,b,c){var d=this;d.marker=new google.maps.Marker({position:new google.maps.LatLng(b,c),map:a,draggable:!0}),d.title=""}var b=function(){var b=this;b.localStoreLocations=[],b.allLocations=ko.observableArray(),b.visibleLocations=ko.observableArray(),b.map,b.currentLocation=ko.observable({}),b.infowindow=void 0,b.locationSearchQuery=ko.observable(""),b.showAll=ko.observable(!1),b.showListView=ko.observable(!1),b.showList=function(){b.showListView(1==b.showListView()?!1:!0)},b.locationSearchSuggestions=ko.computed(function(){var a=b.locationSearchQuery().toLowerCase();return""==a&&1==b.showListView()?ko.utils.arrayFilter(b.localStoreLocations,function(a,c){return b.allLocations()[c].marker.setVisible(!0),!0}):ko.utils.arrayFilter(b.localStoreLocations,function(c,d){var e=c.title.toLowerCase().indexOf(a)>-1;return m=b.allLocations()[d].marker,m.setVisible(e),void 0==b.infowindow||e||b.infowindow.marker!=m||b.closeInfoWindow(),e})}),b.showLocationSuggestions=ko.observable(!1),b.initializeSearchText=function(){b.showLocationSuggestions(!0)},b.showLocationSearchDiv=ko.computed(function(){var a=!1;return a=1==b.showListView()?!0:b.showLocationSuggestions()===!1?!1:""==b.locationSearchQuery()?!1:b.locationSearchSuggestions().length>0?!0:!1}),b.initialize=function(){b.mapOptions={zoom:8,center:new google.maps.LatLng(-34.397,150.644),panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM}},b.map=new google.maps.Map(document.getElementById("map-canvas"),b.mapOptions),b.loadLocations(),google.maps.event.addListener(b.map,"click",function(c){var d=new a(b.map,c.latLng.lat(),c.latLng.lng());b.addLocationEventListeners(d),google.maps.event.trigger(d.marker,"click")})},google.maps.event.addDomListener(window,"load",b.initialize),b.addLocationEventListeners=function(a){google.maps.event.addListener(a.marker,"click",function(){b.currentLocation(a),b.showInfoWindow(),b.locationSearchQuery("")})},b.showLocation=function(c){if(!(c instanceof a)){var d=b.localStoreLocations.indexOf(c);if(!(d>-1))return console.log("No search result"),-1;b.currentLocation(b.allLocations()[d])}b.showInfoWindow()},b.showInfoWindow=function(){var a=b.currentLocation();b.showLocationSuggestions(!1),b.locationSearchQuery(a.title),(void 0===b.infowindow||b.infowindow.marker!==a.marker)&&(void 0!==b.infowindow&&b.infowindow.close(),b.infowindow=new google.maps.InfoWindow({content:document.getElementById("infowindow-template").innerHTML}),b.infowindow.marker=a.marker,b.infowindow.open(b.map,a.marker),google.maps.event.addListener(b.infowindow,"domready",function(){ko.applyBindings(b,document.getElementById("infowindow"))}),google.maps.event.addListener(b.infowindow,"closeclick",function(){b.infowindow=void 0,b.locationSearchQuery("")}))},b.closeInfoWindow=function(){void 0!=b.infowindow&&(b.infowindow.close(),b.infowindow=void 0)},b.saveLocation=function(){var a=b.currentLocation(),c=b.allLocations.indexOf(a),d={title:a.title,lat:a.marker.getPosition().lat(),lng:a.marker.getPosition().lng()};c>-1?(b.allLocations[c]=a,b.localStoreLocations[c]=d):(b.allLocations.push(a),b.localStoreLocations.push(d)),localStorage.locations=JSON.stringify(b.localStoreLocations),b.closeInfoWindow()},b.removeLocation=function(){var a=b.currentLocation();a.marker.setMap(null);var c=b.allLocations.indexOf(a);c>-1&&(b.localStoreLocations.splice(c,1),b.allLocations.remove(a),localStorage.locations=JSON.stringify(b.localStoreLocations),b.locationSearchQuery(""))},b.loadLocations=function(){if(localStorage.locations){b.localStoreLocations=JSON.parse(localStorage.locations);for(var c=0;c<b.localStoreLocations.length;c++){var d=b.localStoreLocations[c],e=new a(b.map,d.lat,d.lng);e.title=d.title,b.addLocationEventListeners(e),b.allLocations.push(e)}}}};ko.applyBindings(new b)});