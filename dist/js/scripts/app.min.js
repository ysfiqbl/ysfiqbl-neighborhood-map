$(document).ready(function(){function a(a,b,c){this.marker=new google.maps.Marker({position:new google.maps.LatLng(b,c),map:a,draggable:!0}),this.title="",this.address=ko.observable(),this.checkinsCount=ko.observable(),this.tipCount=ko.observable(),this.usersCount=ko.observable(),this.images=ko.observableArray()}function b(){this.index="https://api.foursquare.com/v2",this.clientId="ERHT3FHFXMWICB0G4LBHE1GU51LFYBYP3JS0DJU2LPAZAXDR",this.clientSecret="1HPXTVYASF2DDEHPPN14XHEQW0B2R1WI4GDY1MVMTYZN3XGK",this.version="20130815",this.xhr}a.prototype.toJSON=function(){return{title:this.title,lat:this.marker.getPosition().lat(),lng:this.marker.getPosition().lng()}},function(){this.search=function(a,b){var c=[this.index,"venues","search"].join("/"),d={ll:a.ll,query:a.query,radius:50,client_id:this.clientId,client_secret:this.clientSecret,v:this.version,intent:"browse"};this.xhr&&4!=this.xhr.readyState&&(this.xhr.abort(),console.log("Aborted previous request")),this.xhr=$.get(c,d,b,"json")}}.call(b.prototype);var c=function(){var c=this;c.allLocations=[],c.map,c.currentLocation=ko.observable({}),c.infowindow=void 0,c.locationSearchQuery=ko.observable(""),c.showAll=ko.observable(!1),c.showListView=ko.observable(!1),c.foursquareRequest=new b,c.instagramRequest=new InstagramRequest,c.showInfo=ko.observable(!1),c.showList=function(){c.showListView(1==c.showListView()?!1:!0)},c.locationSearchSuggestions=ko.computed(function(){var a=c.locationSearchQuery().toLowerCase();return""==a&&1==c.showListView()?ko.utils.arrayFilter(c.allLocations,function(a){return a.marker.setVisible(!0),!0}):ko.utils.arrayFilter(c.allLocations,function(b){var d=b.title.toLowerCase().indexOf(a)>-1;return m=b.marker,m.setVisible(d),void 0==c.infowindow||d||c.infowindow.marker!=m||c.closeInfoWindow(),d})}),c.showLocationSuggestions=ko.observable(!1),c.initializeSearchText=function(){c.showLocationSuggestions(!0)},c.showLocationSearchDiv=ko.computed(function(){var a=!1;return a=1==c.showListView()?!0:c.showLocationSuggestions()===!1?!1:""==c.locationSearchQuery()?!1:c.locationSearchSuggestions().length>0?!0:!1}),c.initialize=function(){c.mapOptions={zoom:16,center:new google.maps.LatLng(6.8412,79.874),panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM}},c.map=new google.maps.Map(document.getElementById("map-canvas"),c.mapOptions),c.loadLocations(),google.maps.event.addListener(c.map,"click",function(b){var d=new a(c.map,b.latLng.lat(),b.latLng.lng());c.addLocationEventListeners(d),google.maps.event.trigger(d.marker,"click")})},google.maps.event.addDomListener(window,"load",c.initialize),c.addLocationEventListeners=function(a){google.maps.event.addListener(a.marker,"click",function(){c.currentLocation(a),c.showInfoWindow(),c.locationSearchQuery("")})},c.showLocation=function(a){c.currentLocation(a),c.showInfoWindow()},c.showInfoWindow=function(){var a=c.currentLocation();if(c.showInfo(!1),""!=c.currentLocation().title){var b=a.marker.getPosition();c.foursquareRequest.search({ll:[b.lat(),b.lng()].join(","),query:a.title},c.foursquareResponseHandler)}c.showLocationSuggestions(!1),c.locationSearchQuery(a.title),(void 0===c.infowindow||c.infowindow.marker!==a.marker)&&(void 0!==c.infowindow&&c.infowindow.close(),c.infowindow=new google.maps.InfoWindow({content:document.getElementById("infowindow-template").innerHTML}),c.infowindow.marker=a.marker,c.infowindow.open(c.map,a.marker),google.maps.event.addListener(c.infowindow,"domready",function(){ko.applyBindings(c,document.getElementById("infowindow"))}),google.maps.event.addListener(c.infowindow,"closeclick",function(){c.infowindow=void 0,c.locationSearchQuery("")}))},c.closeInfoWindow=function(){void 0!=c.infowindow&&(c.infowindow.close(),c.infowindow=void 0)},c.saveLocation=function(){var a=c.currentLocation(),b=c.allLocations.indexOf(a);b>-1?c.allLocations[b]=a:c.allLocations.push(a),localStorage.locations=JSON.stringify(c.allLocations),c.closeInfoWindow()},c.removeLocation=function(){var a=c.currentLocation();a.marker.setMap(null);var b=c.allLocations.indexOf(a);b>-1&&(c.allLocations.splice(b,1),localStorage.locations=JSON.stringify(c.allLocations),c.locationSearchQuery(""))},c.loadLocations=function(){if(localStorage.locations)for(var b,d,e=JSON.parse(localStorage.locations),f=0;f<e.length;f++)b=e[f],d=new a(c.map,b.lat,b.lng),d.title=b.title,c.addLocationEventListeners(d),c.allLocations.push(d)},c.foursquareResponseHandler=function(a){var b=a.response.venues;if($.isEmptyObject(b))c.currentLocation().address("n/a"),c.currentLocation().checkinsCount("n/a"),c.currentLocation().tipCount("n/a"),c.currentLocation().usersCount("n/a");else{var d=b[0],e=d.stats;console.log(d),c.currentLocation().address(d.location.formattedAddress.join(",")),c.currentLocation().checkinsCount(e.checkinsCount||0),c.currentLocation().tipCount(e.tipCount),c.currentLocation().usersCount(e.usersCount)}c.showInfo(!0)}};ko.applyBindings(new c)});