$(document).ready(function(){function a(a,b,c){var d=this;d.marker=new google.maps.Marker({position:new google.maps.LatLng(b,c),map:a,draggable:!0}),d.title=ko.observable(""),d.category=ko.observable(),d.labels=ko.observableArray(),d.lat=ko.observable(b),d.lng=ko.observable(c)}(function(){this.setCategory=function(a){this.category(a)},this.addLabel=function(a){this.categories.indexOf(category)<0?this.categories.push(category):alert("Location already belongs to category.")},this.removeLabel=function(a){this.categories.remove(a)}}).call(a.prototype);var b=function(){var b=this;b.localStoreLocations=[],b.allLocations=ko.observableArray(),b.visibleLocations=ko.observableArray(),b.map,b.infowindow=void 0,b.locationSearchQuery=ko.observable(""),b.locationSearchSuggestions=ko.computed(function(){var a=b.locationSearchQuery().toLowerCase();return ko.utils.arrayFilter(b.localStoreLocations,function(b){return b.title.toLowerCase().indexOf(a)>-1})}),b.showLocationSearchDiv=ko.computed(function(){return""==b.locationSearchQuery()?!1:b.locationSearchSuggestions().length>0}),b.initialize=function(){b.mapOptions={zoom:8,center:new google.maps.LatLng(-34.397,150.644),panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM}},b.map=new google.maps.Map(document.getElementById("map-canvas"),b.mapOptions),b.loadLocations(),google.maps.event.addListener(b.map,"click",function(c){var d=new a(b.map,c.latLng.lat(),c.latLng.lng());b.addLocationEventListeners(d),google.maps.event.trigger(d.marker,"click")})},google.maps.event.addDomListener(window,"load",b.initialize),b.showLocation=function(a){var c=b.localStoreLocations.indexOf(a);c>-1&&(a=b.allLocations()[c],b.locationSearchQuery(a.title()),google.maps.event.trigger(a.marker,"click"))},b.removeLocation=function(a){a.marker.setMap(null);var c=b.allLocations.indexOf(a);c>-1&&(b.allLocations.remove(a),b.localStoreLocations.splice(c,1),localStorage.locations=JSON.stringify(b.localStoreLocations))},b.addLocationEventListeners=function(a){google.maps.event.addListener(a.marker,"click",function(){if(void 0===b.infowindow||b.infowindow.marker!==a.marker){void 0!==b.infowindow&&b.infowindow.close();var c=document.createElement("div"),d=document.createElement("input");d.type="text",d.value=a.title(),c.appendChild(d);var e=document.createElement("button");e.innerHTML="Save",e.addEventListener("click",function(a){return function(){a.title(d.value),b.saveLocation(a)}}(a)),c.appendChild(e);var f=document.createElement("button");f.innerHTML="Delete",f.addEventListener("click",function(a){return function(){b.removeLocation(a)}}(a)),c.appendChild(f),b.infowindow=new google.maps.InfoWindow({content:c}),b.infowindow.marker=a.marker,b.infowindow.open(b.map,a.marker)}})},b.saveLocation=function(a){var c=b.allLocations.indexOf(a),d={title:a.title(),lat:a.marker.getPosition().lat(),lng:a.marker.getPosition().lng(),labels:a.labels(),category:a.category()};c>-1?(b.allLocations[c]=a,b.localStoreLocations[c]=d):(b.allLocations.push(a),b.localStoreLocations.push(d)),localStorage.locations=JSON.stringify(b.localStoreLocations)},b.loadLocations=function(){if(localStorage.locations){b.localStoreLocations=JSON.parse(localStorage.locations);for(var c=0;c<b.localStoreLocations.length;c++){var d=b.localStoreLocations[c],e=new a(b.map,d.lat,d.lng);e.title(d.title),b.addLocationEventListeners(e),b.allLocations.push(e)}}}};ko.applyBindings(new b)});